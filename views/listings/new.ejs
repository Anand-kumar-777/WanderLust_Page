<%_ layout('layouts/boilerplate.ejs') %>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const options = document.querySelectorAll(".category-option");
    const selectedCategory = document.getElementById("selectedCategory");
    const hiddenInput = document.getElementById("categoryInput");

    options.forEach(option => {
      option.addEventListener("click", function (e) {
        e.preventDefault();  // prevent href="#"

        const value = this.getAttribute("data-value");
        const iconHTML = this.querySelector("i").outerHTML;

        // Set selected text and icon in dropdown button
        selectedCategory.innerHTML = `${iconHTML} ${value}`;

        // Set value for hidden input for form submission
        hiddenInput.value = value;
      });
    });
  });
</script>



    <div class="row mt-3">
        <div class="col-8 offset-2" >
        <h2>New Post</h2>
    <form method="POST" action="/listings" novalidate class="needs-validation" enctype="multipart/form-data">
        <div class="mb-3">
        <label for="title" class="form-label">Title</label>
        <input name="listing[title]" type="text" class="form-control"  placeholder="Enter Title" required>
        <div class="invalid-feedback">Enter Title Name</div>
        </div>
        <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea name="listing[description]" placeholder="Description" class="form-control" required></textarea>
            <div class="invalid-feedback">Please enter a short description</div>
            </div>
         
<!-- For Dropdown Select option -->
<div class="mb-3">
  <label for="categoryDropdown" class="form-label">Select a Category</label>
  <div class="dropdown">
    <button class="btn btn-outline-dark dropdown-toggle w-100 text-start" type="button" id="categoryDropdown" data-bs-toggle="dropdown" aria-expanded="false">
      <span id="selectedCategory"><i class="fa fa-tags"></i> Select a category</span>
    </button>
    <ul class="dropdown-menu w-100" aria-labelledby="categoryDropdown" style="max-height: 300px; overflow-y: auto;">
      <% const categories = [
        {name: "Trending", icon: "fa-solid fa-fire"},
        {name: "Mountain", icon: "fa-solid fa-mountain"},
        {name: "Iconic Cities", icon: "fa-solid fa-mountain-city"},
        {name: "Temple", icon: "fa-brands fa-fort-awesome"},
        {name: "Arctic", icon: "fa-snowflake"},
        {name: "Rooms", icon: "fa-solid fa-bed"},
        {name: "Amazing Pools", icon: "fa-person-swimming"},
        {name: "Camping", icon: "fa-campground"},
        {name: "Farms", icon: "fa-solid fa-cow"},
        {name: "Domes", icon: "fa-solid fa-igloo"},
        {name: "Boats", icon: "fa-solid fa-ship"},
      ]; %>

      <% categories.forEach(cat => { %>
        <li>
          <a class="dropdown-item d-flex align-items-center category-option" href="#" data-value="<%= cat.name %>">
            <i class="fa <%= cat.icon %> me-2"></i> <%= cat.name %>
          </a>
        </li>
      <% }); %>
    </ul>
  </div>

  <!-- âœ… FIXED: name="listing[category]" -->
  <input type="hidden" id="categoryInput" name="listing[category]">
</div>


        <div class="mb-3">
        <label for="image" class="form-label">Upload Image</label>
        <input name="listing[image]" class="form-control" type="file"></input>
        </div>

      <div class="row">
        <div class="mb-3 col-md-4">
            <label for="price" class="label-form">Price</label>
            <input name="listing[price]" placeholder="Enter Price" class="form-control" required>
            <div class="invalid-feedback">Enter Valid Price</div>
            </div>
           <div class="mb-3 col-md-8">
            <label for="location" class="form-label">Location</label>
            <input type="text" name="listing[location]" class="form-control" placeholder="Enter location" required>
            <div class="invalid-feedback">Please Enter Correct Location</div>
           </div>  
     </div>  
        <div class="mb-3">
        <label for="country" class="form-label">Country</label>
        <input type="text" name="listing[country]" class="form-control" placeholder="Country" required>
        <div class="invalid-feedback">Please enter country name</div>
        </div>
        <br>
        <button class="btn btn-dark add-btn mb-4">Add</button>
    </form>
   </div>
</div>